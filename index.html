<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è—¥ç‰©æ›ç®—å°å¹«æ‰‹</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-teal-100 min-h-screen flex items-center justify-center">
  <div class="bg-white shadow-lg rounded-2xl p-8 w-full max-w-md">
    <!-- æ¨™é¡Œ -->
    <div class="flex items-center space-x-3 mb-6">
      <div class="bg-teal-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-xl">+</div>
      <h1 class="text-2xl font-bold text-gray-800">è—¥ç‰©æ›ç®—å°å¹«æ‰‹</h1>
    </div>

    <!-- è—¥ç‰©é¸æ“‡ -->
    <label class="block text-gray-700 font-semibold mb-2" for="drug">é¸æ“‡è—¥ç‰©</label>
    <select id="drug" class="w-full border border-gray-300 rounded-lg px-4 py-2 mb-4">
      <option disabled selected>è«‹é¸æ“‡è—¥ç‰©</option>
      <option>Dormicum</option>
      <option>Nimbex</option>
      <option>Adrenalineï¼ˆå‘¨é‚Šéœè„ˆï¼‰</option>
      <option>Adrenalineï¼ˆä¸­å¤®éœè„ˆï¼‰</option>
      <option>Levophedï¼ˆå‘¨é‚Šéœè„ˆï¼‰</option>
      <option>Levophedï¼ˆä¸­å¤®éœè„ˆï¼‰</option>
      <option>Primacor</option>
      <option>PGE1</option>
      <option>Dopamine(æ–°ç”Ÿå…’å°ˆç”¨)</option>
      <option>Dopamine(premix)</option>
      <option>Dopamine(premixå°åŠç¨€é‡‹)</option>
      <option>Dopamine(è‡ªå·±æ³¡è£½)</option>
    </select>

    <!-- æœ¬é™¢æ³¡æ³•èˆ‡å–®ä½é¡¯ç¤º -->
    <div class="mb-6">
      <p class="text-sm text-gray-600">æœ¬é™¢æ³¡æ³•ï¼š<span id="concentration">â€”</span></p>
      <p class="text-sm text-gray-600">å¸¸ç”¨åŠ‘é‡å–®ä½ï¼š<span id="unit">â€”</span></p>
    </div>

    <!-- é«”é‡è¼¸å…¥ -->
    <label class="block text-gray-700 font-semibold mb-2" for="weight">
      ç—…ç«¥é«”é‡ï¼ˆå…¬æ–¤ï¼‰
    </label>
    <input id="weight" type="number" placeholder="è«‹è¼¸å…¥é«”é‡" class="w-full border border-gray-300 rounded-lg px-4 py-2 mb-4" />

    <!-- å¤–é™¢æ³¡æ³• -->
    <div class="mb-4">
      <label class="block text-gray-700 font-semibold mb-2">å¤–é™¢æ³¡æ³•</label>
      <div class="flex space-x-2">
        <input id="externalDose" type="number" placeholder="mgï¼ˆPGE1 è«‹ç”¨ mcgï¼‰" class="w-1/2 border border-gray-300 rounded-lg px-4 py-2" />
        <input id="externalVolume" type="number" placeholder="mL" class="w-1/2 border border-gray-300 rounded-lg px-4 py-2" />
      </div>
    </div>

    <!-- å¤–é™¢ rate -->
    <label class="block text-gray-700 font-semibold mb-2" for="externalRate">
      å¤–é™¢ rateï¼ˆmL/hrï¼‰
    </label>
    <input id="externalRate" type="number" placeholder="è«‹è¼¸å…¥ rate" class="w-full border border-gray-300 rounded-lg px-4 py-2 mb-6" />

    <!-- çµæœå€ -->
    <div id="result" class="bg-gray-100 text-gray-700 rounded-lg p-4 min-h-[80px]">
      ğŸ’¡ è¼¸å…¥å®Œæˆå¾Œï¼Œé€™è£¡æœƒé¡¯ç¤ºæ›ç®—å¾Œçš„çµæœã€‚
    </div>
  </div>

  <script>
    // è¨­å®šå„è—¥ç‰©æœ¬é™¢æ³¡æ³•ï¼ˆå«æ¿ƒåº¦ã€å–®ä½ã€ç‰¹æ®Šæ¢ä»¶ï¼‰
    const concentrationMap = {
      'Dormicum': { dose: 15, volume: 15 },
      'Nimbex': { dose: 10, volume: 10 },
      'Adrenalineï¼ˆå‘¨é‚Šéœè„ˆï¼‰': { dose: 1, volume: 50 },
      'Adrenalineï¼ˆä¸­å¤®éœè„ˆï¼‰': { dose: 1, volume: 20 },
      'Levophedï¼ˆå‘¨é‚Šéœè„ˆï¼‰': { dose: 4, volume: 250 },
      'Levophedï¼ˆä¸­å¤®éœè„ˆï¼‰': { dose: 4, volume: 100 },
      'Primacor': { dose: 10, volume: 50 },
      'PGE1': { dose: 20, volume: 20, unit: 'mcg', displayUnit: 'ng/kg/min' },
      'Dopamine(æ–°ç”Ÿå…’å°ˆç”¨)': { dose: 0, volume: 0, fixed: true, fixedValue: 10 },
      'Dopamine(premix)': { dose: 400, volume: 250 },
      'Dopamine(premixå°åŠç¨€é‡‹)': { dose: 400, volume: 500 },
      'Dopamine(è‡ªå·±æ³¡è£½)': { dose: 200, volume: 0 },
    };

    // å„è—¥ç‰©å°æ‡‰çš„åŠ‘é‡å–®ä½ï¼ˆé¡¯ç¤ºç”¨é€”ï¼‰
    const unitMap = {
      'Dormicum': 'mcg/kg/min',
      'Nimbex': 'mcg/kg/min',
      'Adrenalineï¼ˆå‘¨é‚Šéœè„ˆï¼‰': 'mcg/kg/min',
      'Adrenalineï¼ˆä¸­å¤®éœè„ˆï¼‰': 'mcg/kg/min',
      'Levophedï¼ˆå‘¨é‚Šéœè„ˆï¼‰': 'mcg/kg/min',
      'Levophedï¼ˆä¸­å¤®éœè„ˆï¼‰': 'mcg/kg/min',
      'Primacor': 'mcg/kg/min',
      'PGE1': 'ng/kg/minï¼ˆç³»çµ±ä»¥ mcg è¨ˆç®—ï¼‰',
      'Dopamine(æ–°ç”Ÿå…’å°ˆç”¨)': 'mcg/kg/min',
      'Dopamine(premix)': 'mcg/kg/min',
      'Dopamine(premixå°åŠç¨€é‡‹)': 'mcg/kg/min',
      'Dopamine(è‡ªå·±æ³¡è£½)': 'mcg/kg/min'
    };

    document.getElementById('drug').addEventListener('change', function () {
      const drug = this.value;
      const info = concentrationMap[drug];
      let concentrationText = 'â€”';
      if (drug === 'Dopamine(premix)') {
        concentrationText = 'ä¸€æ•´åŒ…400mg in 250mLçš„ï¼Œä¸ç”¨æ³¡';
      } else if (drug === 'Dopamine(è‡ªå·±æ³¡è£½)') {
        concentrationText = 'é«”é‡â‰¦10kgï¼š200mg in 250mLï¼›é«”é‡ï¼10kgï¼š200mg in 125mL';
      } else {
        concentrationText = info.fixed ? '1mL/hr = 10mcg/kg/min' : `${info.dose}${info.unit || 'mg'} in ${info.volume}mL`;
      }
      document.getElementById('concentration').innerText = concentrationText;
      document.getElementById('unit').innerText = unitMap[drug] || 'â€”';
      calculateRate();
    });

    // ç›£è½æ‰€æœ‰è¼¸å…¥æ¬„ä½ï¼Œåªè¦è®Šå‹•å°±é‡æ–°è¨ˆç®—
    const inputs = ['drug', 'weight', 'externalDose', 'externalVolume', 'externalRate'];
    inputs.forEach(id => {
      document.getElementById(id).addEventListener('input', calculateRate);
    });

    // â­ æ ¸å¿ƒæ›ç®—å‡½å¼
    function calculateRate() {
      const drug = document.getElementById('drug').value;
      const weight = parseFloat(document.getElementById('weight').value);
      const extDose = parseFloat(document.getElementById('externalDose').value);
      const extVol = parseFloat(document.getElementById('externalVolume').value);
      const extRate = parseFloat(document.getElementById('externalRate').value);
      const resultBox = document.getElementById('result');

      if (!drug || isNaN(weight) || isNaN(extDose) || isNaN(extVol) || isNaN(extRate)) {
        resultBox.innerHTML = 'ğŸ’¡ è«‹å®Œæ•´è¼¸å…¥æ‰€æœ‰æ¬„ä½ã€‚';
        return;
      }

      const inputIsMcg = concentrationMap[drug].unit === 'mcg';
      const extDoseUnit = inputIsMcg ? 1 : 1000;
      const internalDoseUnit = inputIsMcg ? 1 : 1000;

      // å¤–é™¢æ¿ƒåº¦ = åŠ‘é‡ Ã· é«”ç©ï¼ˆå–®ä½ mcg/mLï¼‰
      const extConc = (extDose * extDoseUnit) / extVol;

      // æ›ç®—æˆåŠ‘é‡å¼·åº¦ï¼šmcg/kg/min = (æ¿ƒåº¦ Ã— rate) Ã· é«”é‡ Ã· 60
      let strength = (extConc * extRate) / weight / 60;

      let displayUnit = unitMap[drug];
      let displayStrength = strength;

      // PGE1 é¡¯ç¤ºç‚º ng/kg/minï¼Œè¦ä¹˜ 1000
      if (drug === 'PGE1') {
        displayStrength = strength * 1000;
        displayUnit = 'ng/kg/min';
      }

      // ç‰¹ä¾‹ï¼šå›ºå®šæ›ç®—å…¬å¼ï¼Œä¸é€²è¡Œä¸€èˆ¬è¨ˆç®—
      if (drug === 'Dopamine(æ–°ç”Ÿå…’å°ˆç”¨)') {
        const fixedValue = concentrationMap[drug].fixedValue;
        const suggestedRate = displayStrength / fixedValue;
        const suggestedDose = weight * 6;
        resultBox.innerHTML = `
          <p>ğŸ’¡ <strong>æ›ç®—å¾ŒåŠ‘é‡ï¼š</strong>${displayStrength.toFixed(2)} ${unitMap[drug]}</p>
          <p>ğŸ“¦ <strong>æœ¬é™¢å¸¸è¦æœƒæ³¡æˆï¼š</strong>1mL/hr = 10mcg/kg/min</p>
          <p>ğŸ”§ <strong>å»ºè­°æ³¡æ³•ï¼š</strong>${suggestedDose.toFixed(1)}mg in 10mL</p>
          <p>ğŸ’§ <strong>å»ºè­°æœ¬é™¢ rateï¼š</strong>${suggestedRate.toFixed(2)} mL/hr</p>
        `;
        return;
      }

      // premix è—¥ç‰©ï¼šå·²çŸ¥æ¿ƒåº¦ï¼Œåæ¨ rate
      if (drug === 'Dopamine(premix)' || drug === 'Dopamine(premixå°åŠç¨€é‡‹)') {
        const internal = concentrationMap[drug];
        const internalConc = (internal.dose * 1000) / internal.volume;
        const suggestedRate = (strength * weight * 60) / internalConc;
        resultBox.innerHTML = `
          <p>ğŸ’¡ <strong>æ›ç®—å¾ŒåŠ‘é‡ï¼š</strong>${strength.toFixed(2)} ${unitMap[drug]}</p>
          <p>ğŸ“¦ <strong>æœ¬é™¢æ³¡æ³•ï¼š</strong>${drug === 'Dopamine(premix)' ? 'ä¸€æ•´åŒ…400mg in 250mLçš„ï¼Œä¸ç”¨æ³¡' : '400mg in 500mL'}</p>
          <p>ğŸ’§ <strong>å»ºè­°æœ¬é™¢ rateï¼š</strong>${suggestedRate.toFixed(2)} mL/hr</p>
        `;
        return;
      }

      // æ ¹æ“šé«”é‡æ±ºå®šæ³¡æ³•ï¼ˆé«”é‡ > 10kg ç”¨125mLï¼‰
      if (drug === 'Dopamine(è‡ªå·±æ³¡è£½)') {
        const volume = weight > 10 ? 125 : 250;
        const dose = concentrationMap[drug].dose;
        const internalConc = (dose * 1000) / volume;
        const suggestedRate = (strength * weight * 60) / internalConc;
        resultBox.innerHTML = `
          <p>ğŸ’¡ <strong>æ›ç®—å¾ŒåŠ‘é‡ï¼š</strong>${strength.toFixed(2)} ${unitMap[drug]}</p>
          <p>ğŸ“¦ <strong>æœ¬é™¢æ³¡æ³•ï¼š</strong>200mg in ${volume}mL</p>
          <p>ğŸ’§ <strong>å»ºè­°æœ¬é™¢ rateï¼š</strong>${suggestedRate.toFixed(2)} mL/hr</p>
        `;
        return;
      }

      const internal = concentrationMap[drug];
      const internalConc = (internal.dose * internalDoseUnit) / internal.volume;

      // è‹¥å¤–é™¢æ¿ƒåº¦ = æœ¬é™¢æ¿ƒåº¦ï¼Œå°±ä¸ç”¨æ›ç®— rate
      if (Math.abs(extConc - internalConc) < 0.0001) {
        resultBox.innerHTML = `
          <p>ğŸ’¡ <strong>æ›ç®—å¾ŒåŠ‘é‡ï¼š</strong>${displayStrength.toFixed(2)} ${displayUnit}</p>
          <p>ğŸ“¦ <strong>æœ¬é™¢æ³¡æ³•ï¼š</strong>${internal.dose}${internal.unit || 'mg'} in ${internal.volume}mL</p>
          <p>ğŸ’§ <strong>å»ºè­°æœ¬é™¢ rateï¼š</strong>${extRate.toFixed(2)} mL/hrï¼ˆèˆ‡å¤–é™¢ç›¸åŒï¼‰</p>
        `;
        return;
      }

      // å¦å‰‡åæ¨ rateï¼šrate = (å¼·åº¦ Ã— é«”é‡ Ã— 60) Ã· æœ¬é™¢æ¿ƒåº¦
      const rate = (strength * weight * 60) / internalConc;
      resultBox.innerHTML = `
        <p>ğŸ’¡ <strong>æ›ç®—å¾ŒåŠ‘é‡ï¼š</strong>${displayStrength.toFixed(2)} ${displayUnit}</p>
        <p>ğŸ“¦ <strong>æœ¬é™¢æ³¡æ³•ï¼š</strong>${internal.dose}${internal.unit || 'mg'} in ${internal.volume}mL</p>
        <p>ğŸ’§ <strong>å»ºè­°æœ¬é™¢ rateï¼š</strong>${rate.toFixed(2)} mL/hr</p>
      `;
    }
  </script>
</body>
</html>
