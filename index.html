<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è—¥ç‰©æ›ç®—å°å¹«æ‰‹</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-teal-100 min-h-screen flex flex-col">
  <main class="flex-grow flex items-center justify-center">
  <div class="bg-white shadow-lg rounded-2xl p-8 w-full max-w-md">
    <div class="flex items-center space-x-3 mb-6">
      <div class="bg-teal-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-xl">+</div>
      <h1 class="text-2xl font-bold text-gray-800">è—¥ç‰©æ›ç®—å°å¹«æ‰‹</h1>
    </div>

    <details class="mb-4 text-sm text-gray-600">
      <summary class="cursor-pointer text-gray-800 font-semibold mb-1">ğŸ“ æ›´æ–°è¨˜éŒ„ (change log)</summary>
      <ul class="list-disc list-inside mt-2">
        <li><strong>v1.0.0ï¼ˆ2025/06/21ï¼‰ï¼š</strong>åˆç‰ˆé‡‹å‡ºï¼Œæ„Ÿè¬éŒ¢é†«å¸«å”åŒè¦åŠƒèˆ‡è‡¨åºŠå»ºè­°ã€‚</li>
        <li><strong>v1.0.1ï¼ˆ2025/06/22ï¼‰ï¼š</strong>å¢åŠ ã€Œè¨ˆç®—éç¨‹å…¬å¼é¡¯ç¤ºã€åŠŸèƒ½ã€‚</li>
        <li><strong>v1.0.2ï¼ˆ2026/01/16ï¼‰ï¼š</strong>å„ªåŒ–æ‰‹æ©Ÿç‰ˆé¢ï¼ˆæ–°å¢ in å­—æ¨£ã€èª¿æ•´æç¤ºæ–‡å­—ä½ç½®ï¼‰ã€ä¿®æ­£å…¬å¼é¡¯ç¤ºç²¾åº¦èª¤å·®ã€æœ¬é™¢ rate çµæœæ”¹ç‚ºå°æ•¸é»å¾Œ 1 ä½ã€‚</li>
      </ul>
    </details>

    <label class="block text-gray-700 font-semibold mb-2" for="drug">é¸æ“‡è—¥ç‰©</label>
    <select id="drug" class="w-full border border-gray-300 rounded-lg px-4 py-2 mb-4">
      <option disabled selected>è«‹é¸æ“‡è—¥ç‰©</option>
      <option>Dormicum</option>
      <option>Nimbex</option>
      <option>Adrenalineï¼ˆå‘¨é‚Šéœè„ˆï¼‰</option>
      <option>Adrenalineï¼ˆä¸­å¤®éœè„ˆï¼‰</option>
      <option>Levophedï¼ˆå‘¨é‚Šéœè„ˆï¼‰</option>
      <option>Levophedï¼ˆä¸­å¤®éœè„ˆï¼‰</option>
      <option>Primacor</option>
      <option>PGE1</option>
      <option>Dopamine(æ–°ç”Ÿå…’å°ˆç”¨)</option>
      <option>Dopamine(premix)</option>
      <option>Dopamine(premixå°åŠç¨€é‡‹)</option>
      <option>Dopamine(è‡ªå·±æ³¡è£½)</option>
    </select>

    <div class="mb-6">
      <p class="text-sm text-gray-600">æœ¬é™¢æ³¡æ³•ï¼š<span id="concentration">â€”</span></p>
      <p class="text-sm text-gray-600">å¸¸ç”¨åŠ‘é‡å–®ä½ï¼š<span id="unit">â€”</span></p>
    </div>

    <label class="block text-gray-700 font-semibold mb-2" for="weight">ç—…ç«¥é«”é‡ï¼ˆå…¬æ–¤ï¼‰</label>
    <input id="weight" type="number" placeholder="è«‹è¼¸å…¥é«”é‡" class="w-full border border-gray-300 rounded-lg px-4 py-2 mb-4" />

    <div class="mb-4">
      <label class="block text-gray-700 font-semibold mb-2">å¤–é™¢æ³¡æ³•</label>
      <div class="flex items-center space-x-2">
        <input id="externalDose" type="number" placeholder="åŠ‘é‡" class="w-full flex-1 border border-gray-300 rounded-lg px-4 py-2" />
        <span class="text-gray-500 font-bold whitespace-nowrap">in</span>
        <input id="externalVolume" type="number" placeholder="é«”ç©(mL)" class="w-full flex-1 border border-gray-300 rounded-lg px-4 py-2" />
      </div>
      <p class="text-xs text-gray-500 mt-1">â€» åŠ‘é‡å–®ä½é è¨­ç‚º mgï¼ˆPGE1 è«‹è¼¸å…¥ mcgï¼‰</p>
    </div>

    <label class="block text-gray-700 font-semibold mb-2" for="externalRate">å¤–é™¢æµé€Ÿï¼ˆmL/hrï¼‰</label>
    <input id="externalRate" type="number" placeholder="è«‹è¼¸å…¥ rate" class="w-full border border-gray-300 rounded-lg px-4 py-2 mb-6" />

    <div id="result" class="bg-gray-100 text-gray-700 rounded-lg p-4 min-h-[80px]">
      ğŸ’¡ è¼¸å…¥å®Œæˆå¾Œï¼Œé€™è£¡æœƒé¡¯ç¤ºæ›ç®—å¾Œçš„çµæœã€‚
    </div>

    <div id="formula" class="bg-yellow-50 text-yellow-900 border border-yellow-300 mt-4 p-4 rounded-lg font-mono whitespace-pre-wrap text-sm">
      ğŸ“ è¨ˆç®—å…¬å¼å°‡é¡¯ç¤ºæ–¼æ­¤ã€‚
    </div>
  </div>
</main>
<footer class="text-center text-xs text-gray-400 sticky bottom-0 w-full bg-teal-100 py-2 border-t border-gray-300">
  08PE-dose-helper v1.0.2 Â© 2025 by <a href="mailto:t1190t@gmail.com" class="underline hover:text-gray-600">FKHS</a>
</footer>
  
  <script>
  const concentrationMap = {
    'Dormicum': { dose: 15, volume: 15 },
    'Nimbex': { dose: 10, volume: 10 },
    'Adrenalineï¼ˆå‘¨é‚Šéœè„ˆï¼‰': { dose: 1, volume: 50 },
    'Adrenalineï¼ˆä¸­å¤®éœè„ˆï¼‰': { dose: 1, volume: 20 },
    'Levophedï¼ˆå‘¨é‚Šéœè„ˆï¼‰': { dose: 4, volume: 250 },
    'Levophedï¼ˆä¸­å¤®éœè„ˆï¼‰': { dose: 4, volume: 100 },
    'Primacor': { dose: 10, volume: 50 },
    'PGE1': { dose: 20, volume: 20, unit: 'mcg', displayUnit: 'ng/kg/min' },
    'Dopamine(æ–°ç”Ÿå…’å°ˆç”¨)': { dose: 0, volume: 0, fixed: true, fixedValue: 10 },
    'Dopamine(premix)': { dose: 400, volume: 250 },
    'Dopamine(premixå°åŠç¨€é‡‹)': { dose: 400, volume: 500 },
    'Dopamine(è‡ªå·±æ³¡è£½)': { dose: 200, volume: 0 }
  };

  const unitMap = {
    'Dormicum': 'mcg/kg/min',
    'Nimbex': 'mcg/kg/min',
    'Adrenalineï¼ˆå‘¨é‚Šéœè„ˆï¼‰': 'mcg/kg/min',
    'Adrenalineï¼ˆä¸­å¤®éœè„ˆï¼‰': 'mcg/kg/min',
    'Levophedï¼ˆå‘¨é‚Šéœè„ˆï¼‰': 'mcg/kg/min',
    'Levophedï¼ˆä¸­å¤®éœè„ˆï¼‰': 'mcg/kg/min',
    'Primacor': 'mcg/kg/min',
    'PGE1': 'ng/kg/minï¼ˆç³»çµ±ä»¥ mcg è¨ˆç®—ï¼‰',
    'Dopamine(æ–°ç”Ÿå…’å°ˆç”¨)': 'mcg/kg/min',
    'Dopamine(premix)': 'mcg/kg/min',
    'Dopamine(premixå°åŠç¨€é‡‹)': 'mcg/kg/min',
    'Dopamine(è‡ªå·±æ³¡è£½)': 'mcg/kg/min'
  };

  document.getElementById('drug').addEventListener('change', function () {
    const drug = this.value;
    const info = concentrationMap[drug];
    let concentrationText = 'â€”';
    if (drug === 'Dopamine(premix)') {
      concentrationText = 'ä¸€æ•´åŒ…400mg in 250mLçš„ï¼Œä¸ç”¨æ³¡';
    } else if (drug === 'Dopamine(è‡ªå·±æ³¡è£½)') {
      concentrationText = 'é«”é‡â‰¦10kgï¼š200mg in 250mLï¼›é«”é‡ï¼10kgï¼š200mg in 125mL';
    } else {
      concentrationText = info.fixed ? '1mL/hr = 10mcg/kg/min' : `${info.dose}${info.unit || 'mg'} in ${info.volume}mL`;
    }
    document.getElementById('concentration').innerText = concentrationText;
    document.getElementById('unit').innerText = unitMap[drug] || 'â€”';
    calculateRate();
  });

  ['weight', 'externalDose', 'externalVolume', 'externalRate'].forEach(id => {
    document.getElementById(id).addEventListener('input', calculateRate);
  });

  function calculateRate() {
    const drug = document.getElementById('drug').value;
    const weight = parseFloat(document.getElementById('weight').value);
    const extDose = parseFloat(document.getElementById('externalDose').value);
    const extVol = parseFloat(document.getElementById('externalVolume').value);
    const extRate = parseFloat(document.getElementById('externalRate').value);
    const resultBox = document.getElementById('result');
    const formulaBox = document.getElementById('formula');

    if (!drug || isNaN(weight) || isNaN(extDose) || isNaN(extVol) || isNaN(extRate)) {
      resultBox.innerHTML = 'ğŸ’¡ è«‹å®Œæ•´è¼¸å…¥æ‰€æœ‰æ¬„ä½ã€‚';
      formulaBox.innerText = 'ğŸ“ è¨ˆç®—å…¬å¼å°‡é¡¯ç¤ºæ–¼æ­¤ã€‚';
      return;
    }

    const inputIsMcg = concentrationMap[drug].unit === 'mcg';
    const extDoseUnit = inputIsMcg ? 1 : 1000;
    const internalDoseUnit = inputIsMcg ? 1 : 1000;
    const extConc = (extDose * extDoseUnit) / extVol;
    let strength = (extConc * extRate) / weight / 60;

    let displayUnit = unitMap[drug];
    let displayStrength = strength;
    let formulaText = `ğŸ“ è¨ˆç®—å…¬å¼ï¼š\n`;
    formulaText += `å¤–é™¢æ¿ƒåº¦ = ${extDose}${inputIsMcg ? 'mcg' : 'mg'} Ã· ${extVol}mL = ${(extDose / extVol).toFixed(4)} ${inputIsMcg ? 'mcg' : 'mg'}/mL\n`;
    
    if (!inputIsMcg) {
      formulaText += `è½‰æ›ç‚º mcg/mLï¼š${(extDose / extVol).toFixed(4)} Ã— 1000 = ${(extConc).toFixed(2)} mcg/mL\n`;
    }
    // ä¿®æ”¹ï¼šå°‡å…¬å¼ä¸­çš„å¼·åº¦é¡¯ç¤ºç‚º 4 ä½å°æ•¸ï¼Œé¿å… 0.07 vs 0.0667 çš„èª¤å·®
    formulaText += `æ›ç®—åŠ‘é‡ = ${extConc.toFixed(2)} Ã— ${extRate} Ã· ${weight} Ã· 60 = ${displayStrength.toFixed(4)} ${displayUnit}`;

    if (drug === 'PGE1') {
      displayStrength = strength * 1000;
      displayUnit = 'ng/kg/min';
      formulaText += `\nè½‰æ›ç‚º ngï¼š${strength.toFixed(4)} Ã— 1000 = ${displayStrength.toFixed(2)} ng/kg/min`;
    }

    if (drug === 'Dopamine(æ–°ç”Ÿå…’å°ˆç”¨)') {
      const fixedValue = concentrationMap[drug].fixedValue;
      const suggestedDose = weight * 6;
      const suggestedRate = displayStrength / fixedValue;
      resultBox.innerHTML = `
        <p>ğŸ’¡ <strong>æ›ç®—å¾ŒåŠ‘é‡ï¼š</strong>${displayStrength.toFixed(2)} ${unitMap[drug]}</p>
        <p>ğŸ“¦ <strong>æœ¬é™¢å¸¸è¦æœƒæ³¡æˆï¼š</strong>1mL/hr = 10mcg/kg/min</p>
        <p>ğŸ”§ <strong>å»ºè­°æ³¡æ³•ï¼š</strong>${suggestedDose.toFixed(1)}mg in 10mL</p>
        <p>ğŸ’§ <strong>å»ºè­°æœ¬é™¢ rateï¼š</strong>${suggestedRate.toFixed(1)} mL/hr</p>`; // ä¿®æ”¹ï¼šrate æ”¹ç‚ºå°æ•¸é» 1 ä½
      formulaText += `\næ›ç®—æœ¬é™¢ rate = ${displayStrength.toFixed(2)} Ã· 10 = ${suggestedRate.toFixed(1)} mL/hr`;
      formulaBox.innerText = formulaText;
      return;
    }

    if (drug.includes('Dopamine(premix')) {
      const internal = concentrationMap[drug];
      const internalConc = (internal.dose * 1000) / internal.volume;
      const suggestedRate = (strength * weight * 60) / internalConc;
      resultBox.innerHTML = `
        <p>ğŸ’¡ <strong>æ›ç®—å¾ŒåŠ‘é‡ï¼š</strong>${strength.toFixed(2)} ${unitMap[drug]}</p>
        <p>ğŸ“¦ <strong>æœ¬é™¢æ³¡æ³•ï¼š</strong>${drug === 'Dopamine(premix)' ? 'ä¸€æ•´åŒ…400mg in 250mLçš„ï¼Œä¸ç”¨æ³¡' : '400mg in 500mL'}</p>
        <p>ğŸ’§ <strong>å»ºè­°æœ¬é™¢ rateï¼š</strong>${suggestedRate.toFixed(1)} mL/hr</p>`; // ä¿®æ”¹ï¼šrate æ”¹ç‚ºå°æ•¸é» 1 ä½
      formulaText += `\næœ¬é™¢æ¿ƒåº¦ = ${(internal.dose)}mg Ã· ${internal.volume}mL Ã— 1000 = ${internalConc.toFixed(2)} mcg/mL`;
      formulaText += `\næ›ç®—æœ¬é™¢ rate = ${strength.toFixed(4)} Ã— ${weight} Ã— 60 Ã· ${internalConc.toFixed(2)} = ${suggestedRate.toFixed(1)} mL/hr`; // ä¿®æ”¹ï¼šstrength ç”¨ 4 ä½ï¼Œrate ç”¨ 1 ä½
      formulaBox.innerText = formulaText;
      return;
    }

    if (drug === 'Dopamine(è‡ªå·±æ³¡è£½)') {
      const volume = weight > 10 ? 125 : 250;
      const dose = concentrationMap[drug].dose;
      const internalConc = (dose * 1000) / volume;
      const suggestedRate = (strength * weight * 60) / internalConc;
      resultBox.innerHTML = `
        <p>ğŸ’¡ <strong>æ›ç®—å¾ŒåŠ‘é‡ï¼š</strong>${strength.toFixed(2)} ${unitMap[drug]}</p>
        <p>ğŸ“¦ <strong>æœ¬é™¢æ³¡æ³•ï¼š</strong>200mg in ${volume}mL</p>
        <p>ğŸ’§ <strong>å»ºè­°æœ¬é™¢ rateï¼š</strong>${suggestedRate.toFixed(1)} mL/hr</p>`; // ä¿®æ”¹ï¼šrate æ”¹ç‚ºå°æ•¸é» 1 ä½
      formulaText += `\næœ¬é™¢æ¿ƒåº¦ = 200mg Ã· ${volume}mL Ã— 1000 = ${internalConc.toFixed(2)} mcg/mL`;
      formulaText += `\næ›ç®—æœ¬é™¢ rate = ${strength.toFixed(4)} Ã— ${weight} Ã— 60 Ã· ${internalConc.toFixed(2)} = ${suggestedRate.toFixed(1)} mL/hr`;
      formulaBox.innerText = formulaText;
      return;
    }

    const internal = concentrationMap[drug];
    const internalConc = (internal.dose * internalDoseUnit) / internal.volume;
    if (Math.abs(extConc - internalConc) < 0.0001) {
      resultBox.innerHTML = `
        <p>ğŸ’¡ <strong>æ›ç®—å¾ŒåŠ‘é‡ï¼š</strong>${displayStrength.toFixed(2)} ${displayUnit}</p>
        <p>ğŸ“¦ <strong>æœ¬é™¢æ³¡æ³•ï¼š</strong>${internal.dose}${internal.unit || 'mg'} in ${internal.volume}mL</p>
        <p>ğŸ’§ <strong>å»ºè­°æœ¬é™¢ rateï¼š</strong>${extRate.toFixed(1)} mL/hrï¼ˆèˆ‡å¤–é™¢ç›¸åŒï¼‰</p>`;
      formulaText += `\nå› æ¿ƒåº¦ä¸€è‡´ï¼Œç›´æ¥ä½¿ç”¨åŸ rateï¼š${extRate.toFixed(1)} mL/hr`;
      formulaBox.innerText = formulaText;
      return;
    }

    const rate = (strength * weight * 60) / internalConc;
    resultBox.innerHTML = `
      <p>ğŸ’¡ <strong>æ›ç®—å¾ŒåŠ‘é‡ï¼š</strong>${displayStrength.toFixed(2)} ${displayUnit}</p>
      <p>ğŸ“¦ <strong>æœ¬é™¢æ³¡æ³•ï¼š</strong>${internal.dose}${internal.unit || 'mg'} in ${internal.volume}mL</p>
      <p>ğŸ’§ <strong>å»ºè­°æœ¬é™¢ rateï¼š</strong>${rate.toFixed(1)} mL/hr</p>`; // ä¿®æ”¹ï¼šrate æ”¹ç‚ºå°æ•¸é» 1 ä½
    formulaText += `\næœ¬é™¢æ¿ƒåº¦ = ${internal.dose}${inputIsMcg ? 'mcg' : 'mg'} Ã· ${internal.volume}mL Ã— ${inputIsMcg ? '1' : '1000'} = ${internalConc.toFixed(2)} mcg/mL`;
    // ä¿®æ”¹ï¼šå…¬å¼ä¸­å¼·åº¦é¡¯ç¤º 4 ä½ï¼Œçµæœé¡¯ç¤º 1 ä½
    formulaText += `\næ›ç®—æœ¬é™¢ rate = ${strength.toFixed(4)} Ã— ${weight} Ã— 60 Ã· ${internalConc.toFixed(2)} = ${rate.toFixed(1)} mL/hr`;
    formulaBox.innerText = formulaText;
  }
</script>
</body>
</html>
